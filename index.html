<script src="https://unpkg.com/html5-qrcode/minified/html5-qrcode.min.js"></script>

<!-- Rest des HTML bleibt unverändert -->

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const cameraButton = document.getElementById("cameraButton");
        const captureButton = document.getElementById("captureButton");
        const video = document.getElementById("video");
        const photo = document.getElementById("photo");

        const menuButton = document.getElementById("menuButton");
        const menuModal = document.getElementById("menuModal");
        const closeButton = document.querySelector(".close");

        const html5QrCode = new Html5Qrcode("reader"); // QR-Code-Reader initialisieren
        let isScanning = false;

        // Menü öffnen und schließen
        menuButton.onclick = function() {
            menuModal.style.display = "block";
        };
        closeButton.onclick = function() {
            menuModal.style.display = "none";
        };
        window.onclick = function(event) {
            if (event.target == menuModal) {
                menuModal.style.display = "none";
            }
        };

        // Kamera starten
        cameraButton.onclick = async function() {
            try {
                if (isScanning) return; // Verhindert mehrfaches Starten

                // QR-Code-Scanner starten
                await html5QrCode.start(
                    { facingMode: "environment" }, // Rückkamera bevorzugt
                    {
                        fps: 10, // Scans pro Sekunde
                        qrbox: { width: 250, height: 250 } // QR-Code-Bereich
                    },
                    qrCodeMessage => {
                        alert(`QR-Code erkannt: ${qrCodeMessage}`);
                        html5QrCode.stop(); // Scanner stoppen
                        isScanning = false;
                    },
                    errorMessage => {
                        console.warn(`QR-Code-Fehler: ${errorMessage}`);
                    }
                );
                isScanning = true;
            } catch (error) {
                console.error("Kamera-Zugriff fehlgeschlagen:", error);
                alert("Kamera-Zugriff fehlgeschlagen. Bitte Berechtigungen prüfen.");
            }
        };
    });
</script>
